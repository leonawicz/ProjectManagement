<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title></title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Project Management</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="rpm" class="dropdown-toggle" data-toggle="dropdown">rpm <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">About rpm</li>
              <li><a href="index.html">Introduction</a></li>
              <li><a href="code_sankey.html">Related items</a></li>
              <li><a href="pm.html">Example usage</a></li>
            </ul>

          <li class="dropdown">
            <a href="r-code" class="dropdown-toggle" data-toggle="dropdown">R Code <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="objects.html">Default objects</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="func_new.html">Start a new project</a></li>
              <li><a href="func_rmd.html">Working with Rmd files</a></li>
              <li><a href="func_convert.html">Document conversion</a></li>
              <li><a href="func_organize.html">Organize documents</a></li>
              <li><a href="func_stats.html">Project statistics</a></li>
              <li><a href="func_website.html">Make a project website</a></li>
              <li><a href="func_user_website.html">Github user website</a></li>
            </ul>

          <li class="dropdown">
            <a href="all-projects" class="dropdown-toggle" data-toggle="dropdown">All Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Hierarchy of current projects</li>
              <li><a href="proj_sankey.html">Projects diagram</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Access all projects</li>
              <li><a href="http://leonawicz.github.io">leonawicz.github.io</a></li>
            </ul>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/ProjectManagement">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>



<div id="functions-document-conversion" class="section level3">
<h3>Functions: Document conversion</h3>
<p>The main function for conversion between Rmd and Rnw files is <code>convertDocs</code>. This function contains several internal support functions, each of which is somewhat limited in how much specific conversion it can achieve. The functions below were written with my particular style of Rmd and Rnw documentation in mind. As such they are necessarily a bit idiosyncratic and cannot account for every possible difference found between Rmd and Rnw formatting across any pair of documents. I only strived to speed up the process by which I convert my own documents, most of which follow a set of general rules and expectations most of the time. Anything atypical which doesn’t convert properly can be adjusted by hand afterward. This is still better than rewriting, copy-pasting, and search-and-replacing many sections of many files on a recurring basis. Further improvements in conversion will be added later.</p>
<div id="rules-and-assumptions-regarding-these-functions" class="section level5">
<h5>Rules and assumptions regarding these functions</h5>
<ul>
<li>When converting to Rmd, all Rnw file lines beginning with a backslash which are in the main body of the code (beyond the title, author, etc.) and are not part of a code chunk identifier string are stripped rather than converted to anything.</li>
<li>Only title and author are parsed from the Rnw lines prior to where the <strong>R</strong> code chunks begin. LaTeX libraries and such are dropped.</li>
<li>When converting to Rnw, standard, minimal LaTeX libraries and other requirements prior to beginning the document are inserted by default in place of the Rmd yaml front-matter.</li>
<li>Rmd files must have yaml front-matter prior to converting to Rnw, identified always by the second line in the document to begin with <code>---</code>. More generally, conversion aside, it is expected than any Rmd file has a yaml front-matter section in the context of <code>rpm</code>.</li>
</ul>
</div>
<div id="formatting-rules" class="section level5">
<h5>Formatting rules</h5>
<ul>
<li>I never use two consecutive asterisks or underscores except to indicate bold text</li>
<li>Text with typewriter font in Rnw files is converted to text within backticks in Rmd files and vice versa.</li>
<li>Italics or other formatting are not considered at this time.</li>
<li>Lists in Rmd files (like this one), are not yet addressed in conversion to Rnw and vice versa.</li>
<li>In fact anything not explicitly mentioned here is not yet addressed.</li>
</ul>
</div>
<div id="heading-rules" class="section level5">
<h5>Heading rules</h5>
<ul>
<li>I never (intentionally) use the two most extreme headings in Rmd files, <code>#</code> and <code>######</code>. I only use <code>##</code> through <code>#####</code>.</li>
<li>I never go beyond <code>subsubsubsection</code> in Rnw files.</li>
<li>Any occurrence of a one- or two-<code>#</code> identified heading is converted to a new <code>section</code> heading in an Rnw file whereas a <code>section</code> heading converts to a <code>##</code> heading.</li>
<li>Similarly, five- or six-<code>#</code> identified headings in Rmd convert to the maximum <code>subsubsubsection</code> which back-converts to a <code>#####</code> heading.</li>
<li>Three- and four-<code>#</code> identified Rmd headings convert to <code>subsection</code> and <code>subsubsection</code> identified Rnw headings, respectively, and vice versa. As such, these are the only true one-to-one heading conversions.</li>
</ul>
<p>This may all sound like a lot, but it’s not. It does a decent job for now. It’s not a true conversion and plenty of work may remain afterward. Again, the point is to make conversion much less tedious and hands-on, which it does well enough so far.</p>
</div>
<div id="swapheadings" class="section level4">
<h4>.swapHeadings</h4>
<p><code>.swapHeadings</code> assists in bidirectional conversion between Rmd and Rnw files. It swaps section headings formatting. It is called directly by <code>.swap</code>, internal to <code>convertDocs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rmd &lt;-&gt; Rnw document conversion Conversion support functions called by</span>
<span class="co"># .swap()</span>
.swapHeadings &lt;-<span class="st"> </span>function(from, to, x) {
    nc &lt;-<span class="st"> </span><span class="kw">nchar</span>(x)
    ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="dv">1</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">&quot;</span>)
    if (!<span class="kw">length</span>(ind)) {
        <span class="co"># assume Rmd file</span>
        ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="dv">1</span>) ==<span class="st"> &quot;#&quot;</span>)
        ind.n &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(ind))
        for (i in <span class="dv">2</span>:<span class="dv">6</span>) {
            ind.tmp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x[ind], <span class="dv">1</span>, i) ==<span class="st"> </span><span class="kw">substr</span>(<span class="st">&quot;######&quot;</span>, <span class="dv">1</span>, i))
            if (<span class="kw">length</span>(ind.tmp)) 
                ind.n[ind.tmp] &lt;-<span class="st"> </span>ind.n[ind.tmp] +<span class="st"> </span><span class="dv">1</span> else break
        }
        for (i in <span class="dv">1</span>:<span class="kw">length</span>(ind)) {
            n &lt;-<span class="st"> </span>ind.n[i]
            input &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">substr</span>(<span class="st">&quot;######&quot;</span>, <span class="dv">1</span>, n), <span class="st">&quot; &quot;</span>)
            h &lt;-<span class="st"> </span>x[ind[i]]
            h &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">*&quot;</span>, <span class="st">&quot;_&quot;</span>, h)  <span class="co"># Switch any markdown boldface asterisks in headings to double underscores</span>
            heading &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">substr</span>(h, n +<span class="st"> </span><span class="dv">2</span>, nc[ind[i]]))
            <span class="co"># h &lt;- gsub(input, &#39;&#39;, h)</span>
            if (n &lt;=<span class="st"> </span><span class="dv">2</span>) 
                subs &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">&quot;</span> else if (n ==<span class="st"> </span><span class="dv">3</span>) 
                subs &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">sub&quot;</span> else if (n ==<span class="st"> </span><span class="dv">4</span>) 
                subs &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">subsub&quot;</span> else if (n &gt;=<span class="st"> </span><span class="dv">5</span>) 
                subs &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">subsubsub&quot;</span>
            output &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span>, subs, <span class="st">&quot;section{&quot;</span>, heading, <span class="st">&quot;}</span><span class="ch">\n</span><span class="st">&quot;</span>)
            x[ind[i]] &lt;-<span class="st"> </span><span class="kw">gsub</span>(h, output, h)
        }
    } else {
        <span class="co"># assume Rnw file</span>
        ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">section&quot;</span>)
        if (<span class="kw">length</span>(ind)) {
            for (i in <span class="dv">1</span>:<span class="kw">length</span>(ind)) {
                h &lt;-<span class="st"> </span>x[ind[i]]
                heading &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;## &quot;</span>, <span class="kw">substr</span>(h, <span class="dv">10</span>, <span class="kw">nchar</span>(h) -<span class="st"> </span><span class="dv">2</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
                x[ind[i]] &lt;-<span class="st"> </span>heading
            }
        }
        ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="dv">4</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">sub&quot;</span>)
        if (<span class="kw">length</span>(ind)) {
            for (i in <span class="dv">1</span>:<span class="kw">length</span>(ind)) {
                h &lt;-<span class="st"> </span>x[ind[i]]
                z &lt;-<span class="st"> </span><span class="kw">substr</span>(h, <span class="dv">2</span>, <span class="dv">10</span>)
                if (z ==<span class="st"> &quot;subsubsub&quot;</span>) {
                  p &lt;-<span class="st"> &quot;##### &quot;</span>
                  n &lt;-<span class="st"> </span><span class="dv">19</span>
                } else if (<span class="kw">substr</span>(z, <span class="dv">1</span>, <span class="dv">6</span>) ==<span class="st"> &quot;subsub&quot;</span>) {
                  p &lt;-<span class="st"> &quot;#### &quot;</span>
                  n &lt;-<span class="st"> </span><span class="dv">16</span>
                } else if (<span class="kw">substr</span>(z, <span class="dv">1</span>, <span class="dv">3</span>) ==<span class="st"> &quot;sub&quot;</span>) {
                  p &lt;-<span class="st"> &quot;### &quot;</span>
                  n &lt;-<span class="st"> </span><span class="dv">13</span>
                }
                heading &lt;-<span class="st"> </span><span class="kw">paste0</span>(p, <span class="kw">substr</span>(h, n, <span class="kw">nchar</span>(h) -<span class="st"> </span><span class="dv">2</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
                x[ind[i]] &lt;-<span class="st"> </span>heading
            }
        }
    }
    x
}</code></pre>
</div>
<div id="swapchunks" class="section level4">
<h4>.swapChunks</h4>
<p><code>.swapChunks</code> assists in bidirectional conversion between Rmd and Rnw files. It swaps code chunk formatting. It is called directly by <code>.swap</code>, internal to <code>convertDocs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rmd &lt;-&gt; Rnw document conversion Conversion support functions called by</span>
<span class="co"># .swap()</span>
.swapChunks &lt;-<span class="st"> </span>function(from, to, x, <span class="dt">offset.end =</span> <span class="dv">1</span>) {
    gsbraces &lt;-<span class="st"> </span>function(txt) <span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">{&quot;</span>, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">{&quot;</span>, txt)
    nc &lt;-<span class="st"> </span><span class="kw">nchar</span>(x)
    chunk.start.open &lt;-<span class="st"> </span><span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="kw">nchar</span>(from[<span class="dv">1</span>])) ==<span class="st"> </span>from[<span class="dv">1</span>]
    chunk.start.close &lt;-<span class="st"> </span><span class="kw">substr</span>(x, nc -<span class="st"> </span>offset.end -<span class="st"> </span><span class="kw">nchar</span>(from[<span class="dv">2</span>]) +<span class="st"> </span><span class="dv">1</span>, nc -<span class="st"> </span>
<span class="st">        </span>offset.end) ==<span class="st"> </span>from[<span class="dv">2</span>]
    chunk.start &lt;-<span class="st"> </span><span class="kw">which</span>(chunk.start.open &amp;<span class="st"> </span>chunk.start.close)
    chunk.end &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="kw">nchar</span>(from[<span class="dv">3</span>])) ==<span class="st"> </span>from[<span class="dv">3</span>] &amp;<span class="st"> </span>nc ==<span class="st"> </span><span class="kw">nchar</span>(from[<span class="dv">3</span>]) +<span class="st"> </span>
<span class="st">        </span>offset.end)
    x[chunk.start] &lt;-<span class="st"> </span><span class="kw">gsub</span>(from[<span class="dv">2</span>], to[<span class="dv">2</span>], <span class="kw">gsub</span>(<span class="kw">gsbraces</span>(from[<span class="dv">1</span>]), <span class="kw">gsbraces</span>(to[<span class="dv">1</span>]), 
        x[chunk.start]))
    x[chunk.end] &lt;-<span class="st"> </span><span class="kw">gsub</span>(from[<span class="dv">3</span>], to[<span class="dv">3</span>], x[chunk.end])
    chunklines &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">mapply</span>(seq, chunk.start, chunk.end)))
    <span class="kw">list</span>(x, chunklines)
}</code></pre>
</div>
<div id="swapemphasis" class="section level4">
<h4>.swapEmphasis</h4>
<p><code>.swapEmphasis</code> assists in bidirectional conversion between Rmd and Rnw files. It swaps text formatting such as boldface and typewriter font. It is called directly by <code>.swap</code>, internal to <code>convertDocs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rmd &lt;-&gt; Rnw document conversion Conversion support functions called by</span>
<span class="co"># .swap() I know I use &#39;**&#39; strictly for bold font in Rmd files.  For now,</span>
<span class="co"># this function assumes: 1. The only emphasis in a doc is boldface or</span>
<span class="co"># typewriter.  2. These instances are always preceded by a space, a carriage</span>
<span class="co"># return, or an open bracket, 3. and followed by a space, period, comma, or</span>
<span class="co"># closing bracket.</span>
.swapEmphasis &lt;-<span class="st"> </span>function(x, <span class="dt">emphasis =</span> <span class="st">&quot;remove&quot;</span>, <span class="dt">pat.remove =</span> <span class="kw">c</span>(<span class="st">&quot;`&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">*</span><span class="ch">\\</span><span class="st">*&quot;</span>, 
    <span class="st">&quot;__&quot;</span>), <span class="dt">pat.replace =</span> pat.remove, <span class="dt">replacement =</span> <span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">texttt</span><span class="ch">\\</span><span class="st">{&quot;</span>, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">textbf</span><span class="ch">\\</span><span class="st">{&quot;</span>, 
    <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">textbf</span><span class="ch">\\</span><span class="st">{&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">}&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">}&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">}&quot;</span>)) {
    
    <span class="kw">stopifnot</span>(emphasis %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;remove&quot;</span>, <span class="st">&quot;replace&quot;</span>))
    n &lt;-<span class="st"> </span><span class="kw">length</span>(pat.replace)
    rep1 &lt;-<span class="st"> </span>replacement[<span class="dv">1</span>:n]
    rep2 &lt;-<span class="st"> </span>replacement[(n +<span class="st"> </span><span class="dv">1</span>):(<span class="dv">2</span> *<span class="st"> </span>n)]
    prefix &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;^&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">{&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>)
    suffix &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">}&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">)&quot;</span>)
    n.p &lt;-<span class="st"> </span><span class="kw">length</span>(prefix)
    n.s &lt;-<span class="st"> </span><span class="kw">length</span>(suffix)
    pat.replace &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="kw">rep</span>(prefix, n), <span class="kw">rep</span>(pat.replace, <span class="dt">each =</span> n.p)), <span class="kw">paste0</span>(<span class="kw">rep</span>(pat.replace, 
        <span class="dt">each =</span> n.s), <span class="kw">rep</span>(suffix, n)))
    replacement &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="kw">rep</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">^&quot;</span>, <span class="st">&quot;&quot;</span>, prefix), n), <span class="kw">rep</span>(rep1, <span class="dt">each =</span> n.p)), 
        <span class="kw">paste0</span>(<span class="kw">rep</span>(rep2, <span class="dt">each =</span> n.s), <span class="kw">rep</span>(suffix, n)))
    if (emphasis ==<span class="st"> &quot;remove&quot;</span>) 
        for (k in <span class="dv">1</span>:<span class="kw">length</span>(pat.remove)) x &lt;-<span class="st"> </span><span class="kw">sapply</span>(x, function(v, p, r) <span class="kw">gsub</span>(p, 
            r, v), <span class="dt">p =</span> pat.remove[k], <span class="dt">r =</span> <span class="st">&quot;&quot;</span>)
    if (emphasis ==<span class="st"> &quot;replace&quot;</span>) 
        for (k in <span class="dv">1</span>:<span class="kw">length</span>(pat.replace)) x &lt;-<span class="st"> </span><span class="kw">sapply</span>(x, function(v, p, r) <span class="kw">gsub</span>(p, 
            r, v), <span class="dt">p =</span> pat.replace[k], <span class="dt">r =</span> replacement[k])
    x
}</code></pre>
</div>
<div id="swap" class="section level4">
<h4>.swap</h4>
<p><code>.swap</code> assists in bidirectional conversion between Rmd and Rnw files. It is called internal to <code>convertDocs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rmd &lt;-&gt; Rnw document conversion Conversion support functions called by</span>
<span class="co"># .convertDocs()</span>
.swap &lt;-<span class="st"> </span>function(file, <span class="dt">header =</span> <span class="ot">NULL</span>, outDir, rmdChunkID, rnwChunkID, emphasis, 
    overwrite, ...) {
    title &lt;-<span class="st"> </span><span class="kw">list</span>(...)$title
    author &lt;-<span class="st"> </span><span class="kw">list</span>(...)$author
    highlight &lt;-<span class="st"> </span><span class="kw">list</span>(...)$highlight
    ext &lt;-<span class="st"> </span><span class="kw">tail</span>(<span class="kw">strsplit</span>(file, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)[[<span class="dv">1</span>]], <span class="dv">1</span>)
    l &lt;-<span class="st"> </span><span class="kw">readLines</span>(file)
    l &lt;-<span class="st"> </span>l[<span class="kw">substr</span>(l, <span class="dv">1</span>, <span class="dv">7</span>) !=<span class="st"> &quot;&lt;style&gt;&quot;</span>]  <span class="co"># Strip any html style lines</span>
    if (ext ==<span class="st"> &quot;Rmd&quot;</span>) {
        from &lt;-<span class="st"> </span>rmdChunkID
        to &lt;-<span class="st"> </span>rnwChunkID
        hl.default &lt;-<span class="st"> &quot;solarized-light&quot;</span>
        out.ext &lt;-<span class="st"> &quot;Rnw&quot;</span>
        h.ind &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">which</span>(l ==<span class="st"> &quot;---&quot;</span>)[<span class="dv">2</span>]
        h &lt;-<span class="st"> </span>l[h.ind]
        t.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(h, <span class="dv">1</span>, <span class="dv">7</span>) ==<span class="st"> &quot;title: &quot;</span>)
        a.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(h, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> &quot;author: &quot;</span>)
        highlight.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(h, <span class="dv">1</span>, <span class="dv">11</span>) ==<span class="st"> &quot;highlight: &quot;</span>)
        if (<span class="kw">is.null</span>(title) &amp;<span class="st"> </span><span class="kw">length</span>(t.ind)) 
            title &lt;-<span class="st"> </span><span class="kw">substr</span>(h[t.ind], <span class="dv">8</span>, <span class="kw">nchar</span>(h[t.ind])) else if (<span class="kw">is.null</span>(title)) 
            title &lt;-<span class="st"> &quot;&quot;</span>
        if (<span class="kw">is.null</span>(author) &amp;<span class="st"> </span><span class="kw">length</span>(a.ind)) 
            author &lt;-<span class="st"> </span><span class="kw">substr</span>(h[a.ind], <span class="dv">9</span>, <span class="kw">nchar</span>(h[a.ind])) else if (<span class="kw">is.null</span>(author)) 
            author &lt;-<span class="st"> &quot;&quot;</span>
        if (<span class="kw">is.null</span>(highlight) &amp;<span class="st"> </span><span class="kw">length</span>(highlight.ind)) 
            highlight &lt;-<span class="st"> </span><span class="kw">substr</span>(h[highlight.ind], <span class="dv">12</span>, <span class="kw">nchar</span>(h[highlight.ind])) else if (<span class="kw">is.null</span>(highlight)) 
            highlight &lt;-<span class="st"> </span>hl.default else if (!(highlight %in%<span class="st"> </span>knit_theme$<span class="kw">get</span>())) 
            highlight &lt;-<span class="st"> </span>hl.default
        if (!<span class="kw">is.null</span>(title)) 
            header &lt;-<span class="st"> </span><span class="kw">c</span>(header, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">title{&quot;</span>, title, <span class="st">&quot;}&quot;</span>))
        if (!<span class="kw">is.null</span>(author)) 
            header &lt;-<span class="st"> </span><span class="kw">c</span>(header, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">author{&quot;</span>, author, <span class="st">&quot;}&quot;</span>))
        if (!<span class="kw">is.null</span>(title)) 
            header &lt;-<span class="st"> </span><span class="kw">c</span>(header, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">maketitle</span><span class="ch">\n</span><span class="st">&quot;</span>)
        header &lt;-<span class="st"> </span><span class="kw">c</span>(header, <span class="kw">paste0</span>(<span class="st">&quot;&lt;&lt;highlight, echo=FALSE&gt;&gt;=</span><span class="ch">\n</span><span class="st">knit_theme$set(knit_theme$get(&#39;&quot;</span>, 
            highlight, <span class="st">&quot;&#39;))</span><span class="ch">\n</span><span class="st">@</span><span class="ch">\n</span><span class="st">&quot;</span>))
    } else if (ext ==<span class="st"> &quot;Rnw&quot;</span>) {
        from &lt;-<span class="st"> </span>rnwChunkID
        to &lt;-<span class="st"> </span>rmdChunkID
        hl.default &lt;-<span class="st"> &quot;tango&quot;</span>
        out.ext &lt;-<span class="st"> &quot;Rmd&quot;</span>
        begin.doc &lt;-<span class="st"> </span><span class="kw">which</span>(l ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">begin{document}&quot;</span>)
        make.title &lt;-<span class="st"> </span><span class="kw">which</span>(l ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">maketitle&quot;</span>)
        if (<span class="kw">length</span>(make.title)) 
            h.ind &lt;-<span class="st"> </span><span class="dv">1</span>:make.title else h.ind &lt;-<span class="st"> </span><span class="dv">1</span>:begin.doc
        h &lt;-<span class="st"> </span>l[h.ind]
        t.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(h, <span class="dv">1</span>, <span class="dv">6</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">title&quot;</span>)
        a.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(h, <span class="dv">1</span>, <span class="dv">7</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">author&quot;</span>)
        highlight.ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(l, <span class="dv">1</span>, <span class="dv">11</span>) ==<span class="st"> &quot;&lt;&lt;highlight&quot;</span>)
        if (<span class="kw">is.null</span>(title) &amp;<span class="st"> </span><span class="kw">length</span>(t.ind)) 
            title &lt;-<span class="st"> </span><span class="kw">substr</span>(h[t.ind], <span class="dv">8</span>, <span class="kw">nchar</span>(h[t.ind]) -<span class="st"> </span><span class="dv">1</span>)
        if (<span class="kw">is.null</span>(author) &amp;<span class="st"> </span><span class="kw">length</span>(a.ind)) 
            author &lt;-<span class="st"> </span><span class="kw">substr</span>(h[a.ind], <span class="dv">9</span>, <span class="kw">nchar</span>(h[a.ind]) -<span class="st"> </span><span class="dv">1</span>)
        if (<span class="kw">length</span>(highlight.ind)) {
            l1 &lt;-<span class="st"> </span>l[highlight.ind +<span class="st"> </span><span class="dv">1</span>]
            h1 &lt;-<span class="st"> </span><span class="kw">substr</span>(l1, <span class="kw">nchar</span>(<span class="st">&quot;knit_theme$set(knit_theme$get(&#39;&quot;</span>) +<span class="st"> </span><span class="dv">1</span>, <span class="kw">nchar</span>(l1) -<span class="st"> </span>
<span class="st">                </span><span class="kw">nchar</span>(<span class="st">&quot;&#39;))</span><span class="ch">\n</span><span class="st">&quot;</span>))
            if (!(h1 %in%<span class="st"> </span>knit_theme$<span class="kw">get</span>())) 
                h1 &lt;-<span class="st"> </span>hl.default
        }
        if (<span class="kw">is.null</span>(highlight) &amp;<span class="st"> </span><span class="kw">length</span>(highlight.ind)) 
            highlight &lt;-<span class="st"> </span>h1 else if (<span class="kw">is.null</span>(highlight)) 
            highlight &lt;-<span class="st"> </span>hl.default else if (!(highlight %in%<span class="st"> </span>knit_theme$<span class="kw">get</span>())) 
            highlight &lt;-<span class="st"> </span>hl.default
        header &lt;-<span class="st"> </span><span class="kw">.rmdHeader</span>(<span class="dt">title =</span> title, <span class="dt">author =</span> author, <span class="dt">highlight =</span> highlight)
        h.chunks &lt;-<span class="st"> </span><span class="kw">.swapChunks</span>(<span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">x =</span> h, <span class="dt">offset.end =</span> <span class="dv">0</span>)
        header &lt;-<span class="st"> </span><span class="kw">c</span>(header, h.chunks[[<span class="dv">1</span>]][h.chunks[[<span class="dv">2</span>]]])
    }
    header &lt;-<span class="st"> </span><span class="kw">paste0</span>(header, <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    l &lt;-<span class="st"> </span><span class="kw">paste0</span>(l[-h.ind], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    l &lt;-<span class="st"> </span><span class="kw">.swapHeadings</span>(<span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">x =</span> l)
    chunks &lt;-<span class="st"> </span><span class="kw">.swapChunks</span>(<span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">x =</span> l)
    l &lt;-<span class="st"> </span>chunks[[<span class="dv">1</span>]]
    if (ext ==<span class="st"> &quot;Rmd&quot;</span>) 
        l &lt;-<span class="st"> </span><span class="kw">.swapEmphasis</span>(<span class="dt">x =</span> l, <span class="dt">emphasis =</span> emphasis)
    if (ext ==<span class="st"> &quot;Rmd&quot;</span>) 
        l[-chunks[[<span class="dv">2</span>]]] &lt;-<span class="st"> </span><span class="kw">sapply</span>(l[-chunks[[<span class="dv">2</span>]]], function(v, p, r) <span class="kw">gsub</span>(p, 
            r, v), <span class="dt">p =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">r =</span> <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">_&quot;</span>)
    l &lt;-<span class="st"> </span><span class="kw">c</span>(header, l)
    if (ext ==<span class="st"> &quot;Rmd&quot;</span>) 
        l &lt;-<span class="st"> </span><span class="kw">c</span>(l, <span class="st">&quot;</span><span class="ch">\n\\</span><span class="st">end{document}</span><span class="ch">\n</span><span class="st">&quot;</span>)
    if (ext ==<span class="st"> &quot;Rnw&quot;</span>) {
        ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">substr</span>(l, <span class="dv">1</span>, <span class="dv">1</span>) ==<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">&quot;</span>)  <span class="co"># drop any remaining lines beginning with a backslash</span>
        l &lt;-<span class="st"> </span>l[-ind]
    }
    outfile &lt;-<span class="st"> </span><span class="kw">file.path</span>(outDir, <span class="kw">gsub</span>(<span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, ext), <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, out.ext), 
        <span class="kw">basename</span>(file)))
    if (overwrite ||<span class="st"> </span>!<span class="kw">file.exists</span>(outfile)) {
        <span class="kw">sink</span>(outfile)
        <span class="kw">sapply</span>(l, cat)
        <span class="kw">sink</span>()
        <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Writing&quot;</span>, outfile))
    }
}</code></pre>
</div>
<div id="convertdocs" class="section level4">
<h4>convertDocs</h4>
<p><code>convertDocs</code> converts between Rmd and Rnw files. The project’s <code>docs/Rmd</code> or <code>docs/Rnw</code> directory is specified. Any files of the same type as the directory are converted to the other type and saved to the other directory. The input files are not removed.</p>
<p>This function speeds up the process of duplicating files, e.g., when wanting to make pdf files from Rnw files when only Rmd files exist. This is almost exclusively what I use this function for. On less frequent occasions I have used it in the other direction when I have Rnw files which were once used to make PDFs but later I decide to put them on the web as a web page and not as a link to a pdf files.</p>
<p>The user still makes specific changes by hand, for example, any required changes to <code>knitr</code> code chunk options that must differ for pdf output vs. html output. The primary benefit is in not having to fuss with large amounts of standard substitutions which can be automated, such as swapping code chunk enclosure styles and common file metadata. Of course, this function is not perfect. It amounts to a text-parsing hack that is intended to handle the most common of idiosyncrasies and differences which exist between my own Rmd and Rnw files in the context of my own limited rule set.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rmd &lt;-&gt; Rnw document conversion Main conversion function</span>
convertDocs &lt;-<span class="st"> </span>function(path, <span class="dt">rmdChunkID =</span> <span class="kw">c</span>(<span class="st">&quot;```{r&quot;</span>, <span class="st">&quot;}&quot;</span>, <span class="st">&quot;```&quot;</span>), <span class="dt">rnwChunkID =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;&lt;&quot;</span>, 
    <span class="st">&quot;&gt;&gt;=&quot;</span>, <span class="st">&quot;@&quot;</span>), <span class="dt">emphasis =</span> <span class="st">&quot;replace&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>, ...) {
    <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(path))
    type &lt;-<span class="st"> </span><span class="kw">basename</span>(path)
    rmd.files &lt;-<span class="st"> </span><span class="kw">list.files</span>(path, <span class="dt">pattern =</span> <span class="st">&quot;.Rmd$&quot;</span>, <span class="dt">full =</span> <span class="ot">TRUE</span>)
    rnw.files &lt;-<span class="st"> </span><span class="kw">list.files</span>(path, <span class="dt">pattern =</span> <span class="st">&quot;.Rnw$&quot;</span>, <span class="dt">full =</span> <span class="ot">TRUE</span>)
    dots &lt;-<span class="st"> </span><span class="kw">list</span>(...)
    if (rmdChunkID[<span class="dv">1</span>] ==<span class="st"> &quot;```{r&quot;</span>) 
        rmdChunkID[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(rmdChunkID[<span class="dv">1</span>], <span class="st">&quot; &quot;</span>)
    if (type ==<span class="st"> &quot;Rmd&quot;</span>) {
        <span class="kw">stopifnot</span>(<span class="kw">length</span>(rmd.files) &gt;<span class="st"> </span><span class="dv">0</span>)
        outDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">dirname</span>(path), <span class="st">&quot;Rnw&quot;</span>)
        if (<span class="kw">is.null</span>(doc.class &lt;-<span class="st"> </span>dots$doc.class)) 
            doc.class &lt;-<span class="st"> &quot;article&quot;</span>
        if (<span class="kw">is.null</span>(doc.packages &lt;-<span class="st"> </span>dots$doc.packages)) 
            doc.packages &lt;-<span class="st"> &quot;geometry&quot;</span>
        doc.class.string &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">documentclass{&quot;</span>, doc.class, <span class="st">&quot;}&quot;</span>)
        doc.packages.string &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">sapply</span>(doc.packages, function(x) <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">usepackage{&quot;</span>, 
            x, <span class="st">&quot;}&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
        if (<span class="st">&quot;geometry&quot;</span> %in%<span class="st"> </span>doc.packages) 
            doc.packages.string &lt;-<span class="st"> </span><span class="kw">c</span>(doc.packages.string, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">geometry{verbose, tmargin=2.5cm, bmargin=2.5cm, lmargin=2.5cm, rmargin=2.5cm}&quot;</span>)
        header.rnw &lt;-<span class="st"> </span><span class="kw">c</span>(doc.class.string, doc.packages.string, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">begin{document}</span><span class="ch">\n</span><span class="st">&quot;</span>)  <span class="co">#,</span>
        <span class="co"># paste0(&#39;&lt;&lt;highlight, echo=FALSE&gt;&gt;=\nknit_theme$set(knit_theme$get(&#39;&#39;,</span>
        <span class="co"># theme, &#39;&#39;))\n@\n&#39;))</span>
    } else if (type ==<span class="st"> &quot;Rnw&quot;</span>) {
        <span class="kw">stopifnot</span>(<span class="kw">length</span>(rnw.files) &gt;<span class="st"> </span><span class="dv">0</span>)
        outDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">dirname</span>(path), <span class="st">&quot;Rmd&quot;</span>)
    } else <span class="kw">stop</span>(<span class="st">&quot;path must end in &#39;Rmd&#39; or &#39;Rnw&#39;.&quot;</span>)
    if (type ==<span class="st"> &quot;Rmd&quot;</span>) {
        <span class="kw">sapply</span>(rmd.files, .swap, <span class="dt">header =</span> header.rnw, <span class="dt">outDir =</span> outDir, <span class="dt">rmdChunkID =</span> rmdChunkID, 
            <span class="dt">rnwChunkID =</span> rnwChunkID, <span class="dt">emphasis =</span> emphasis, <span class="dt">overwrite =</span> overwrite, 
            ...)
        <span class="kw">cat</span>(<span class="st">&quot;.Rmd to .Rnw file conversion complete.</span><span class="ch">\n</span><span class="st">&quot;</span>)
    } else {
        <span class="kw">sapply</span>(rnw.files, .swap, <span class="dt">header =</span> <span class="ot">NULL</span>, <span class="dt">outDir =</span> outDir, <span class="dt">rmdChunkID =</span> rmdChunkID, 
            <span class="dt">rnwChunkID =</span> rnwChunkID, <span class="dt">emphasis =</span> emphasis, <span class="dt">overwrite =</span> overwrite, 
            ...)
        <span class="kw">cat</span>(<span class="st">&quot;.Rnw to .Rmd file conversion complete.</span><span class="ch">\n</span><span class="st">&quot;</span>)
    }
}</code></pre>
</div>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>
<script>
  // manage active state of menu based on current page
  $(document).ready(function () {
  
    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');
    
    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');
	  
  });
</script>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
